# Документация программного кода - Система учета нарядов

## Структура проекта

### Основные файлы
1. `main.py` - главный файл программы, содержащий GUI
2. `database.py` - модуль работы с базой данных
3. `analytics.py` - модуль аналитики и визуализации
4. `requirements.txt` - зависимости проекта

## Описание модулей

### main.py

#### Класс MainWindow
Основной класс приложения, наследующий QMainWindow.

##### Основные методы:
- `__init__()` - инициализация главного окна
- `init_data_tab()` - инициализация вкладки данных
- `init_analytics_tab()` - инициализация вкладки аналитики
- `load_data()` - загрузка данных в таблицу
- `add_record()` - добавление новой записи
- `update_record()` - обновление существующей записи
- `delete_record()` - удаление записи
- `update_analytics()` - обновление аналитических графиков

##### Обработка событий:
- `resizeEvent()` - обработка изменения размера окна
- `delayed_update_analytics()` - отложенное обновление графиков
- `toggle_calendar()` - показ/скрытие календаря
- `update_date_from_calendar()` - обновление даты из календаря

### database.py

#### Класс Database
Класс для работы с SQLite базой данных.

##### Основные методы:
- `__init__(db_name='naryad.db')` - инициализация БД
- `connect()` - установка соединения с БД
- `create_tables()` - создание необходимых таблиц
- `add_record()` - добавление записи
- `delete_record()` - удаление записи
- `update_record()` - обновление записи
- `get_all_records()` - получение всех записей
- `get_workshop_productivity()` - получение производительности цехов
- `get_operation_complexity()` - получение трудоемкости операций
- `get_orders_by_period()` - получение количества нарядов по периодам

##### Структура таблицы naryad:
```sql
CREATE TABLE IF NOT EXISTS naryad (
    shifr TEXT PRIMARY KEY,
    date TEXT NOT NULL,
    workshop_number INTEGER NOT NULL,
    employee_number INTEGER NOT NULL,
    operation_code TEXT NOT NULL,
    time_norm REAL NOT NULL,
    parts_count INTEGER NOT NULL
)
```

### analytics.py

#### Класс Analytics
Класс для анализа данных и создания визуализаций.

##### Основные методы:
- `__init__(database)` - инициализация с настройкой стилей matplotlib
- `plot_orders_by_period()` - график количества нарядов
- `plot_workshop_productivity()` - диаграмма производительности цехов
- `plot_operation_complexity()` - график трудоемкости операций
- `predict_workshop_productivity()` - прогноз производительности цеха

##### Особенности визуализации:
- Использование темной темы
- Адаптивные графики
- Градиентные цветовые схемы
- Интерактивные элементы

## Зависимости проекта

### Основные библиотеки:
- PyQt6 - GUI фреймворк
- SQLite3 - база данных
- Pandas - анализ данных
- NumPy - математические операции
- Matplotlib - визуализация
- Scikit-learn - машинное обучение (прогнозирование)

## Архитектура приложения

### Паттерны проектирования:
1. **MVC (Model-View-Controller)**
   - Model: Database класс
   - View: GUI элементы в MainWindow
   - Controller: методы обработки событий в MainWindow

2. **Observer**
   - Обновление GUI при изменении данных
   - Автоматическое обновление графиков

### Взаимодействие компонентов

#### 1. Поток данных
```
Database <-> MainWindow <-> Analytics
```
- Database хранит и управляет данными
- MainWindow отображает и позволяет редактировать данные
- Analytics анализирует данные и создает визуализации

#### 2. Обновление данных
```
User Input -> MainWindow -> Database -> Analytics -> GUI Update
```
- Пользователь вводит данные
- MainWindow валидирует ввод
- Database сохраняет изменения
- Analytics обновляет аналитику
- GUI отображает обновленные данные и графики

## Особенности реализации

### 1. Управление данными
- Использование SQLite для локального хранения
- Валидация данных перед сохранением
- Поддержка CRUD операций

### 2. Пользовательский интерфейс
- Адаптивный дизайн
- Темная тема
- Интерактивные элементы управления
- Валидация пользовательского ввода

### 3. Аналитика
- Использование pandas для обработки данных
- Matplotlib для визуализации
- Scikit-learn для прогнозирования
- Адаптивные графики

### 4. Оптимизация производительности
- Отложенное обновление графиков
- Эффективное использование памяти
- Оптимизированные SQL-запросы

## Рекомендации по разработке

### 1. Добавление новых функций
- Следовать паттерну MVC
- Использовать существующие классы и методы
- Добавлять новые методы в соответствующие классы

### 2. Модификация базы данных
- Сохранять обратную совместимость
- Использовать миграции при необходимости
- Документировать изменения схемы

### 3. Расширение аналитики
- Добавлять новые методы в класс Analytics
- Следовать существующим паттернам визуализации
- Оптимизировать производительность

### 4. Тестирование
- Проверять валидацию данных
- Тестировать граничные случаи
- Проверять производительность на больших наборах данных
