# Руководство программиста - Система учета нарядов

## Содержание
1. [Назначение и условия применения программы](#назначение-и-условия-применения-программы)
2. [Характеристика программы](#характеристика-программы)
3. [Обращение к программе](#обращение-к-программе)
4. [Входные и выходные данные](#входные-и-выходные-данные)
5. [Сообщения](#сообщения)
6. [Приложения](#приложения)

## Назначение и условия применения программы

### Назначение программы
Система учета нарядов предназначена для автоматизации процессов учета производственных нарядов на предприятии, анализа производительности цехов и трудоемкости операций, а также прогнозирования производительности. Программа реализует следующие функции:

1. Управление нарядами:
   - Добавление новых нарядов
   - Редактирование существующих нарядов
   - Удаление нарядов
   - Отображение всех нарядов в табличном виде

2. Аналитические функции:
   - Анализ количества нарядов по периодам (день, месяц, год)
   - Оценка производительности цехов
   - Анализ трудоемкости операций
   - Прогнозирование производительности цехов на основе исторических данных

### Технические требования
Для функционирования программы необходимы следующие технические средства и программное обеспечение:

1. **Аппаратные требования**:
   - Процессор: x86-64 совместимый
   - Оперативная память: минимум 512 МБ
   - Свободное место на диске: минимум 200 МБ
   - Разрешение экрана: минимум 800x600

2. **Программные требования**:
   - Операционная система: Linux (Ubuntu 18.04+, 64-bit)
   - Python 3.8 или выше (для разработки)
   - Библиотеки Python (для разработки):
     - PyQt6 версии 6.5.2
     - numpy версии 1.24.3
     - matplotlib версии 3.7.2
     - pandas версии 2.0.3
     - scikit-learn версии 1.3.0
     - pyinstaller версии 6.11.1 (для сборки)

## Характеристика программы

### Режим работы программы
Программа функционирует в интерактивном режиме с графическим пользовательским интерфейсом. Взаимодействие с пользователем осуществляется через главное окно приложения, содержащее две основные вкладки:
- Вкладка "Данные" - для работы с нарядами
- Вкладка "Аналитика" - для просмотра аналитической информации

### Архитектура программы
Программа построена по принципу Model-View-Controller (MVC):
1. **Model** - класс Database в модуле database.py, отвечающий за хранение и управление данными
2. **View** - элементы графического интерфейса в классе MainWindow модуля main.py
3. **Controller** - методы обработки событий в классе MainWindow модуля main.py

Дополнительно используется класс Analytics в модуле analytics.py для анализа данных и создания визуализаций.

### Структура программы
Программа состоит из следующих основных файлов:
1. `main.py` - главный файл программы, содержащий GUI
2. `database.py` - модуль работы с базой данных
3. `analytics.py` - модуль аналитики и визуализации
4. `requirements.txt` - зависимости проекта
5. `naryad.spec` - конфигурационный файл для сборки с помощью PyInstaller
6. `qt_runtime_hook.py` - хук для корректной работы PyQt в собранном приложении

### Показатели качества
1. **Производительность**:
   - Время запуска программы: менее 3 секунд
   - Время отклика интерфейса: менее 0.5 секунды
   - Время выполнения запросов к базе данных: менее 1 секунды
   - Время построения графиков: менее 2 секунд

2. **Надежность**:
   - Программа включает обработку исключений для предотвращения аварийного завершения
   - Валидация пользовательского ввода для предотвращения ошибок
   - Автоматическое создание базы данных при первом запуске

3. **Масштабируемость**:
   - Программа способна работать с базой данных, содержащей до 100,000 записей
   - Адаптивный интерфейс, подстраивающийся под размер окна

## Обращение к программе

### Запуск программы
Программа может быть запущена следующими способами:

1. **Запуск скомпилированной версии**:
   ```bash
   chmod +x naryad  # Для Linux, если необходимо
   ./naryad
   ```

2. **Запуск из исходного кода** (для разработчиков):
   ```bash
   python main.py
   ```

### Сборка программы из исходного кода
Для сборки программы из исходного кода необходимо выполнить следующие шаги:

1. Установить зависимости:
   ```bash
   pip install -r requirements.txt
   ```

2. Собрать программу с помощью PyInstaller:
   ```bash
   pyinstaller naryad.spec
   ```

Готовые файлы после сборки будут находиться в папке `dist`.

### Параметры запуска
Программа не принимает параметров командной строки и запускается без дополнительных аргументов.

## Входные и выходные данные

### Входные данные

#### Формат входных данных
Программа принимает следующие входные данные через пользовательский интерфейс:

1. **Данные наряда**:
   - Шифр наряда (строка) - уникальный идентификатор наряда
   - Дата (строка в формате ДД.ММ.ГГГГ) - дата создания наряда
   - Номер цеха (целое число) - идентификатор производственного цеха
   - Табельный номер (целое число) - идентификатор сотрудника
   - Код операции (строка) - идентификатор производственной операции
   - Норма времени (число с плавающей точкой) - нормативное время на выполнение операции
   - Количество деталей (целое число) - количество изготовленных деталей

2. **Параметры аналитики**:
   - Период анализа (строка: "День", "Месяц", "Год")
   - Цех для прогноза (целое число)

#### Организация входных данных
Входные данные вводятся пользователем через элементы графического интерфейса:
- Текстовые поля (QLineEdit)
- Выпадающие списки (QComboBox)
- Календарь (QCalendarWidget)

### Выходные данные

#### Формат выходных данных
Программа формирует следующие выходные данные:

1. **Табличные данные**:
   - Список нарядов, отображаемый в таблице на вкладке "Данные"

2. **Графические данные**:
   - График "Динамика количества нарядов"
   - Круговая диаграмма "Эффективность цехов"
   - Столбчатая диаграмма "Анализ трудоемкости операций"
   - Линейный график "Прогноз производительности цеха"

#### Организация выходных данных
Выходные данные отображаются через элементы графического интерфейса:
- Таблица (QTableWidget)
- Графики (FigureCanvas из matplotlib)

### Структура базы данных
Программа использует базу данных SQLite с одной таблицей `naryad`:

```sql
CREATE TABLE IF NOT EXISTS naryad (
    shifr TEXT PRIMARY KEY,
    date TEXT NOT NULL,
    workshop_number INTEGER NOT NULL,
    employee_number INTEGER NOT NULL,
    operation_code TEXT NOT NULL,
    time_norm REAL NOT NULL,
    parts_count INTEGER NOT NULL
)
```

Описание полей:
- `shifr` - уникальный идентификатор наряда (первичный ключ)
- `date` - дата создания наряда в формате ГГГГ-ММ-ДД
- `workshop_number` - номер производственного цеха
- `employee_number` - табельный номер сотрудника
- `operation_code` - код производственной операции
- `time_norm` - нормативное время на выполнение операции
- `parts_count` - количество изготовленных деталей

## Сообщения

### Информационные сообщения
Программа не выводит информационных сообщений в процессе работы.

### Сообщения об ошибках

1. **Ошибка при добавлении наряда**:
   - Текст: "Запись с таким шифром уже существует"
   - Причина: попытка добавить наряд с шифром, который уже существует в базе данных
   - Действия: используйте другой шифр или отредактируйте существующий наряд

2. **Ошибка при вводе данных**:
   - Текст: "Проверьте правильность ввода данных"
   - Причина: введены некорректные данные в одно или несколько полей формы
   - Действия: проверьте формат даты, убедитесь, что в числовых полях введены только числа, проверьте заполнение всех обязательных полей

3. **Отсутствие данных для построения прогноза**:
   - Текст: "Для построения прогноза необходимо минимум 3 месяца данных для цеха X. Текущее количество месяцев: Y"
   - Причина: недостаточно данных для построения прогноза
   - Действия: добавьте данные за недостающие месяцы

4. **Отсутствие данных для цеха**:
   - Текст: "Нет данных для цеха X"
   - Причина: в базе данных отсутствуют записи для выбранного цеха
   - Действия: добавьте данные для этого цеха или выберите другой цех

5. **Общая ошибка отсутствия данных**:
   - Текст: "Нет данных для построения прогноза"
   - Причина: в базе данных отсутствуют записи
   - Действия: добавьте данные в базу

## Приложения

### Приложение 1: Описание классов и методов

#### Класс MainWindow (main.py)
Основной класс приложения, наследующий QMainWindow.

##### Основные методы:
- `__init__()` - инициализация главного окна
- `init_data_tab()` - инициализация вкладки данных
- `init_analytics_tab()` - инициализация вкладки аналитики
- `load_data()` - загрузка данных в таблицу
- `add_record()` - добавление новой записи
- `update_record()` - обновление существующей записи
- `delete_record()` - удаление записи
- `update_analytics()` - обновление аналитических графиков
- `resizeEvent()` - обработка изменения размера окна
- `delayed_update_analytics()` - отложенное обновление графиков
- `toggle_calendar()` - показ/скрытие календаря
- `update_date_from_calendar()` - обновление даты из календаря
- `clear_form()` - очистка формы
- `get_form_data()` - получение данных из формы
- `load_record_to_form()` - загрузка записи в форму

#### Класс Database (database.py)
Класс для работы с SQLite базой данных.

##### Основные методы:
- `__init__(db_name='naryad.db')` - инициализация БД
- `connect()` - установка соединения с БД
- `create_tables()` - создание необходимых таблиц
- `add_record()` - добавление записи
- `delete_record()` - удаление записи
- `update_record()` - обновление записи
- `search_records()` - поиск записей по различным параметрам
- `get_all_records()` - получение всех записей
- `get_workshop_productivity()` - получение производительности цехов
- `get_operation_complexity()` - получение трудоемкости операций
- `get_orders_by_period()` - получение количества нарядов по периодам
- `close()` - закрытие соединения с БД

#### Класс Analytics (analytics.py)
Класс для анализа данных и создания визуализаций.

##### Основные методы:
- `__init__(database)` - инициализация с настройкой стилей matplotlib
- `plot_orders_by_period()` - график количества нарядов
- `plot_workshop_productivity()` - диаграмма производительности цехов
- `plot_operation_complexity()` - график трудоемкости операций
- `predict_workshop_productivity()` - прогноз производительности цеха

### Приложение 2: Алгоритмы и формулы

#### Расчет производительности цехов
Производительность цеха рассчитывается как отношение количества деталей к норме времени:

```sql
SELECT workshop_number, 
       SUM(parts_count) as total_parts,
       AVG(parts_count * 1.0 / time_norm) as productivity
FROM naryad
WHERE date BETWEEN ? AND ?
GROUP BY workshop_number
ORDER BY productivity DESC
```

#### Расчет трудоемкости операций
Трудоемкость операции рассчитывается как среднее значение нормы времени для каждой операции:

```sql
SELECT operation_code,
       AVG(time_norm) as avg_time,
       COUNT(*) as operation_count
FROM naryad
GROUP BY operation_code
ORDER BY avg_time DESC
```

#### Алгоритм прогнозирования производительности
Для прогнозирования производительности используется линейная регрессия из библиотеки scikit-learn:

1. Данные группируются по месяцам и рассчитывается средняя производительность для каждого месяца
2. Создается модель линейной регрессии
3. Модель обучается на исторических данных
4. Модель используется для прогнозирования производительности на следующие 2 месяца

### Приложение 3: Рекомендации по расширению системы

#### Добавление новых функций
При добавлении новых функций рекомендуется:
1. Следовать паттерну MVC
2. Использовать существующие классы и методы
3. Добавлять новые методы в соответствующие классы

#### Модификация базы данных
При модификации базы данных необходимо:
1. Сохранять обратную совместимость
2. Использовать миграции при необходимости
3. Документировать изменения схемы

#### Расширение аналитики
При расширении аналитических возможностей рекомендуется:
1. Добавлять новые методы в класс Analytics
2. Следовать существующим паттернам визуализации
3. Оптимизировать производительность

#### Рекомендации по тестированию
При тестировании системы необходимо:
1. Проверять валидацию данных
2. Тестировать граничные случаи
3. Проверять производительность на больших наборах данных
